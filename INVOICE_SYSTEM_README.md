# نظام إنشاء الفواتير للأدمن

## نظرة عامة
تم إنشاء نظام شامل لإدارة الفواتير يسمح للأدمن بـ:
- اختيار المنتجات من قاعدة البيانات
- تسعير المنتجات بأسعار مخصصة
- تحديد الكميات
- إنشاء فاتورة PDF
- إرسال الفاتورة للعميل

## الملفات المضافة/المحدثة

### 1. صفحة إنشاء الفاتورة
**الملف:** `lib/view/admin_view/create_invoice_page.dart`

**المميزات:**
- واجهة مقسمة إلى قسمين: قائمة المنتجات والفاتورة
- بحث في المنتجات بالاسم والوصف
- إضافة المنتجات للفاتورة بنقرة واحدة
- تعديل الكميات والأسعار
- إدخال معلومات العميل
- إنشاء الفاتورة باستخدام الخدمة الموجودة

### 2. تحديث خدمة المنتجات
**الملف:** `lib/controller/product_service.dart`

**الإضافات:**
- دالة `getAllProducts()` لجلب جميع المنتجات كـ Future
- تحسين الأداء لاستخدام الفواتير

### 3. تحديث لوحة الأدمن
**الملف:** `lib/view/admin_dashboard/dashboardUi.dart`

**الإضافات:**
- خيار "إنشاء فاتورة" في لوحة الأدمن
- أيقونة مناسبة (receipt_outline)
- ربط بصفحة إنشاء الفاتورة

## كيفية الاستخدام

### 1. الوصول للنظام
1. تسجيل الدخول كأدمن
2. الذهاب للوحة الأدمن
3. اختيار "إنشاء فاتورة"

### 2. إنشاء فاتورة جديدة
1. **البحث عن المنتجات:**
   - استخدم شريط البحث للعثور على منتجات محددة
   - تصفح جميع المنتجات المتاحة

2. **إضافة المنتجات:**
   - اضغط على أيقونة العربة بجانب المنتج
   - سيتم إضافة المنتج بالسعر الأصلي والكمية 1

3. **تخصيص الفاتورة:**
   - **تعديل الكمية:** استخدم أزرار + و - 
   - **تعديل السعر:** اكتب السعر الجديد في الحقل المخصص
   - **حذف منتج:** اضغط على أيقونة الحذف

4. **معلومات العميل:**
   - أدخل اسم العميل
   - أدخل البريد الإلكتروني للعميل

5. **إنشاء الفاتورة:**
   - راجع المجموع الكلي
   - اضغط "إنشاء فاتورة"
   - سيتم إنشاء PDF وإرساله للعميل

## المميزات التقنية

### 1. التحقق من البيانات
- التأكد من وجود منتجات في الفاتورة
- التحقق من معلومات العميل
- رسائل خطأ واضحة

### 2. واجهة المستخدم
- تصميم responsive يعمل على جميع الأحجام
- تأثيرات بصرية جميلة
- سهولة الاستخدام

### 3. إدارة الحالة
- تحديث فوري للمجموع عند تغيير الكميات/الأسعار
- حفظ حالة البحث والتصفية
- إعادة تعيين النموذج بعد الإنشاء

### 4. استخدام الخدمات الموجودة
- `ProductService.getAllProducts()` لجلب المنتجات
- `PdfInvoiceService.generateInvoice()` لإنشاء PDF
- لا توجد خدمات جديدة - استخدام ما هو موجود

## فئة InvoiceItem

```dart
class InvoiceItem {
  final String productId;        // معرف المنتج
  final String productName;      // اسم المنتج
  final double originalPrice;    // السعر الأصلي
  double customPrice;           // السعر المخصص
  int quantity;                 // الكمية
}
```

## تدفق العمل

```
1. تحميل المنتجات من قاعدة البيانات
     ↓
2. عرض المنتجات مع إمكانية البحث
     ↓
3. إضافة المنتجات للفاتورة
     ↓
4. تخصيص الأسعار والكميات
     ↓
5. إدخال معلومات العميل
     ↓
6. إنشاء PDF باستخدام الخدمة الموجودة
     ↓
7. إرسال الفاتورة للعميل
```

## رسائل الخطأ

- "يرجى اختيار منتجات للفاتورة" - عند عدم وجود منتجات
- "يرجى إدخال اسم العميل" - عند عدم إدخال الاسم
- "يرجى إدخال بريد العميل الإلكتروني" - عند عدم إدخال البريد
- "خطأ في تحميل المنتجات" - عند فشل تحميل المنتجات
- "خطأ في إنشاء الفاتورة" - عند فشل إنشاء PDF

## الاختبار

1. **اختبار إضافة المنتجات:**
   - تأكد من إضافة منتجات مختلفة
   - اختبار إضافة نفس المنتج مرتين (يجب زيادة الكمية)

2. **اختبار التخصيص:**
   - تغيير الكميات والأسعار
   - حذف منتجات من الفاتورة

3. **اختبار البحث:**
   - البحث بالاسم العربي والإنجليزي
   - البحث في الوصف

4. **اختبار إنشاء الفاتورة:**
   - مع معلومات صحيحة
   - مع معلومات ناقصة (للتأكد من رسائل الخطأ)

## الملاحظات

- النظام يستخدم الخدمات الموجودة بالكامل
- لا توجد تعديلات على قاعدة البيانات
- متوافق مع التصميم العام للتطبيق
- يدعم اللغة العربية بالكامل
- جاهز للاستخدام الفوري
